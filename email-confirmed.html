<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Email Confirmed ‚Äì UPRISE</title>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --purple: #667eea; --violet: #764ba2; --green: #10B981;
      --dark: #0f0f1a; --card: #1a1a2e;
      --border: rgba(102,126,234,0.18); --text: #e8e8f0;
      --muted: #8888aa;
    }
    html, body { min-height: 100vh; background: var(--dark); font-family: 'DM Sans', sans-serif; color: var(--text); overflow-x: hidden; }
    body::before { content: ''; position: fixed; inset: 0; background: radial-gradient(ellipse 80% 60% at 20% 10%, rgba(102,126,234,0.18) 0%, transparent 60%), radial-gradient(ellipse 60% 50% at 80% 80%, rgba(118,75,162,0.15) 0%, transparent 55%); z-index: 0; pointer-events: none; }
    body::after { content: ''; position: fixed; inset: 0; background-image: linear-gradient(rgba(102,126,234,0.04) 1px, transparent 1px), linear-gradient(90deg, rgba(102,126,234,0.04) 1px, transparent 1px); background-size: 48px 48px; z-index: 0; pointer-events: none; }
    .wrap { position: relative; z-index: 1; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 20px; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 28px; padding: 56px 48px 48px; max-width: 460px; width: 100%; text-align: center; box-shadow: 0 0 0 1px rgba(102,126,234,0.08), 0 32px 80px rgba(0,0,0,0.5), 0 0 60px rgba(102,126,234,0.06); animation: slideUp 0.7s cubic-bezier(.22,1,.36,1) both; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(32px); } to { opacity: 1; transform: translateY(0); } }
    .icon-wrap { position: relative; width: 96px; height: 96px; margin: 0 auto 32px; }
    .icon-ring { position: absolute; inset: -8px; border-radius: 50%; border: 1.5px solid transparent; background: linear-gradient(135deg, var(--purple), var(--violet)) border-box; -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0); -webkit-mask-composite: destination-out; mask-composite: exclude; animation: spin 6s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .icon-circle { width: 96px; height: 96px; border-radius: 50%; background: linear-gradient(135deg, rgba(102,126,234,0.15), rgba(118,75,162,0.15)); border: 1px solid rgba(102,126,234,0.3); display: flex; align-items: center; justify-content: center; font-size: 42px; animation: pop 0.5s cubic-bezier(.34,1.56,.64,1) 0.4s both; }
    @keyframes pop { from { transform: scale(0.4); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .logo { font-family: 'Sora', sans-serif; font-size: 13px; font-weight: 600; letter-spacing: 0.2em; text-transform: uppercase; color: var(--purple); margin-bottom: 28px; opacity: 0; animation: fadeIn 0.5s ease 0.2s forwards; }
    @keyframes fadeIn { to { opacity: 1; } }
    h1 { font-family: 'Sora', sans-serif; font-size: 28px; font-weight: 800; line-height: 1.15; margin-bottom: 10px; background: linear-gradient(135deg, #fff 30%, var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: fadeIn 0.5s ease 0.5s both; }
    .sub { font-size: 14px; color: var(--muted); line-height: 1.6; margin-bottom: 32px; animation: fadeIn 0.5s ease 0.65s both; }
    .features { background: rgba(102,126,234,0.08); border: 1px solid rgba(102,126,234,0.15); border-radius: 16px; padding: 24px 28px; margin-bottom: 32px; text-align: left; animation: fadeIn 0.5s ease 0.75s both; }
    .features p { font-size: 13px; font-weight: 600; color: var(--purple); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 14px; }
    .feature { display: flex; align-items: center; gap: 10px; font-size: 14px; color: var(--text); padding: 5px 0; }
    .feature.premium { color: var(--green); font-weight: 600; }
    .btn { display: block; width: 100%; padding: 16px 24px; border-radius: 14px; border: none; cursor: pointer; font-family: 'Sora', sans-serif; font-size: 15px; font-weight: 700; letter-spacing: 0.02em; background: linear-gradient(135deg, var(--purple) 0%, var(--violet) 100%); color: #fff; box-shadow: 0 8px 32px rgba(102,126,234,0.35); transition: transform 0.18s ease, box-shadow 0.18s ease; text-decoration: none; text-align: center; animation: fadeIn 0.5s ease 0.9s both; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(102,126,234,0.5); }
    .note { margin-top: 20px; font-size: 12px; color: var(--muted); line-height: 1.6; text-align: center; animation: fadeIn 0.5s ease 1s both; }
    .loading { font-size: 14px; color: var(--muted); margin-bottom: 16px; animation: fadeIn 0.3s ease both; }
    .spinner { width: 24px; height: 24px; border: 2px solid rgba(102,126,234,0.2); border-top-color: var(--purple); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 12px; }
    .error-banner { display: none; background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); border-radius: 10px; padding: 14px 16px; margin-bottom: 16px; font-size: 13px; color: #fca5a5; line-height: 1.5; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">

      <!-- Loading state -->
      <div id="loadingState">
        <div class="logo">UPRISE</div>
        <div class="spinner"></div>
        <p class="loading">Confirming your email...</p>
      </div>

      <!-- Success state -->
      <div id="successState" style="display:none;">
        <div class="logo">UPRISE</div>
        <div class="icon-wrap">
          <div class="icon-ring"></div>
          <div class="icon-circle">üåÖ</div>
        </div>
        <h1>You're Confirmed!</h1>
        <p class="sub">Your email has been verified. Welcome to UPRISE!</p>
        <div class="features">
          <p>What you've unlocked</p>
          <div class="feature">üß† &nbsp; Build better mental health habits</div>
          <div class="feature">üåÖ &nbsp; Wake up with purpose and intention</div>
          <div class="feature">üìä &nbsp; Track your mood and emotional wellbeing</div>
          <div class="feature">üèÜ &nbsp; Celebrate progress with achievements</div>
          <div class="feature premium">üíé &nbsp; 7-day Premium trial ‚Äî active!</div>
        </div>
        <a href="uprise://" class="btn">Open UPRISE App ‚Üí</a>
        <p class="note">Can't open? Launch the app manually and log in with your email and password.</p>
      </div>

      <!-- Error state -->
      <div id="errorState" style="display:none;">
        <div class="logo">UPRISE</div>
        <div class="icon-wrap">
          <div class="icon-ring"></div>
          <div class="icon-circle">‚ö†Ô∏è</div>
        </div>
        <h1>Link Expired</h1>
        <p class="sub">This confirmation link has expired or already been used.</p>
        <div class="error-banner" id="errorBanner" style="display:block;"></div>
        <p class="note" style="margin-top:0;">Open the UPRISE app and sign up again to get a new confirmation email.</p>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = 'https://srqtrayblmwmtehexwes.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNycXRyYXlibG13bXRlaGV4d2VzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5MzA2NTEsImV4cCI6MjA4NDUwNjY1MX0.fTvhHFS3s39WLM7txSvHfQsOVNZjZpKVlGMG9-lKXmQ';

    const { createClient } = supabase;
    const client = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Read token and email from URL query params
    const query = window.location.search.substring(1);
    const queryParams = new URLSearchParams(query);
    const token = queryParams.get('token');
    const email = queryParams.get('email');
    const type = queryParams.get('type') || 'signup';

    async function confirmEmail() {
      if (!token || !email) {
        showError('Invalid confirmation link. Please sign up again in the UPRISE app.');
        return;
      }

      try {
        const { data, error } = await client.auth.verifyOtp({
          email: email,
          token: token,
          type: 'signup'
        });

        if (error) {
          showError(error.message || 'Confirmation failed. Please sign up again.');
          return;
        }

        // Sign out after confirming so user logs in manually in the app
        await client.auth.signOut();

        showSuccess();

      } catch (e) {
        showError('Something went wrong. Please try again.');
      }
    }

    function showSuccess() {
      document.getElementById('loadingState').style.display = 'none';
      document.getElementById('successState').style.display = 'block';
      // Try opening app after 2 seconds
      setTimeout(() => { window.location.href = 'uprise://'; }, 2000);
    }

    function showError(message) {
      document.getElementById('loadingState').style.display = 'none';
      document.getElementById('errorState').style.display = 'block';
      document.getElementById('errorBanner').textContent = '‚ö†Ô∏è ' + message;
    }

    // Run on page load
    confirmEmail();
  </script>
</body>
</html>
